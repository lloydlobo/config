# https://github.com/mehalter/myconfig/blob/master/tmux/tmux.conf
# ==========================
# ===  General settings  ===
# ==========================

# Some tweaks to the status line
# set -g status-right "%H:%M"
set -g window-status-current-style "underscore"

# If running inside tmux ($TMUX is set), then change the status line to red
%if #{TMUX}
set -g status-bg red
%endif

# Enable RGB colour if running in xterm(1)
set-option -sa terminal-overrides ",xterm*:Tc"

# Change the default $TERM to tmux-256color / xterm-256color
set -g default-terminal "screen-256color"
# https://mbuffett.com/posts/setting-up-tmux-and-kitty-for-true-color-support/
set-option -sa terminal-overrides ".xterm-kitty:RGB"

set-window-option -g mode-keys vi

# Keep windows around after they exit
set -g remain-on-exit on

# I personally use Ctrl + Space mainly because my Vim leader key is the Space key. To change my prefix to Ctrl + Space:
# https://dev.to/iggredible/useful-tmux-configuration-examples-k3g
unbind C-Space
set -g prefix C-Space
bind C-Space send-prefix
set-option -g repeat-time 0
 
# Turn the mouse on, but without copy mode dragging
set -g mouse on
set-option -g mouse on
unbind -n MouseDrag1Pane
unbind -Tcopy-mode MouseDrag1Pane


# Communicate focus events to vim
set -g focus-events on

# Increase history-limit
set-option -g history-limit 5000

# ======================
# ===  Key bindings  ===
# ======================

# vim-like pane switching
bind -r k select-pane -U 
bind -r j select-pane -D 
bind -r h select-pane -L 
bind -r l select-pane -R

# Some extra key bindings to select higher numbered windows
bind F1 selectw -t:10
bind F2 selectw -t:11
bind F3 selectw -t:12
bind F4 selectw -t:13
bind F5 selectw -t:14
bind F6 selectw -t:15
bind F7 selectw -t:16
bind F8 selectw -t:17
bind F9 selectw -t:18
bind F10 selectw -t:19
bind F11 selectw -t:20
bind F12 selectw -t:21

# A key to toggle between smallest and largest sizes if a window is visible in multiple places
bind F set -w window-size

# new window
bind-key C command-prompt -p "Name of new window: " "new-window -n '%%'"

# Keep current path for new windows
bind c new-window -c "#{pane_current_path}"

# Toggle last windows
bind Space last-window

# Toggle between current & previous session
bind-key C-Space switch-client -l

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded..."

# Kill all panes
bind -r e kill-pane -a

# use with tmux-open plugin TODO
# Open current directory | Error(clashing with rotate panes)
#bind o run-shell "open #{pane_current_path}

# Moving window
bind-key -n C-S-Left swap-window -t -1 \; previous-window
bind-key -n C-S-Right swap-window -t +1 \; next-window


#### basic settings

set-option -g status-justify "left"
#set-option utf8-default on
#set-option -g mouse-select-pane
set-window-option -g mode-keys vi
#set-window-option -g utf8 on

# look'n feel
# set-option -g status-fg cyan
# set-option -g status-bg black
# set -g pane-active-border-style fg=colour166,bg=default
# set -g window-style fg=colour10,bg=default
#set -g window-style "fg=#708183,bg=#001e26
set -g window-style "fg=#586e75,bg=#073642"
#foreground            #708183
#background            #001e26
# set -g window-active-style fg=colour12,bg=default
set-option -g history-limit 64096

set -sg escape-time 10

#### COLOUR

# default statusbar colors
set-option -g status-style bg=colour235,fg=colour136,default

# default window title colors
set-window-option -g window-status-style fg=colour244,bg=colour234,dim

# active window title colors
set-window-option -g window-status-current-style fg=colour166,bg=default,bright

# pane border
#set-option -g pane-border-style fg=colour235 #base02
#set-option -g pane-active-border-style fg=colour136,bg=colour235
#set-option -g pane-active-border-style fg=colour136,bg=colour235

# message text
set-option -g message-style bg=colour235,fg=colour166

# pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# clock
set-window-option -g clock-mode-colour colour64 #green

# allow the title bar to adapt to whatever host you connect to
set -g set-titles on
set -g set-titles-string "#T"

# import
if-shell "uname -s | grep -q Darwin" "source ./macos.conf"

#source ./statusline.conf
#source ./utility.conf

# don't rename windows automatically
set-option -g allow-rename off

# auto window rename
# set-window-option -g automatic-rename

# window indexes
set -g base-index 1
setw -g pane-base-index 1

# No delay for escape key press
#set -sg escape-time 0

# Keys to toggle monitoring activity in a window and the synchronize-panes option
bind m set monitor-activity
bind y set synchronize-panes\; display 'synchronize-panes #{?synchronize-panes,on,off}'
set -g renumber-windows on
# Activity monitoring
setw -g monitor-activity on

set -g visual-activity on

# iTerm2 works with clipboard out of the box, set-clipboard already set to "external"
# tmux show-options -g -s set-clipboard
# set-clipboard on|external

# statusline theme
source "$HOME/.config/tmux/statusline.conf"
# utilities | lazygit
source "$HOME/.config/tmux/utility.conf"

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'tmux-plugins/tmux-logging'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'samoshkin/tmux-plugin-sysstat'
set -g @open-S 'https://www.google.com/search?q='

# Automatic tpm installation  https://github.com/tmux-plugins/tpm/blob/master/docs/automatic_tpm_installation.md
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'


